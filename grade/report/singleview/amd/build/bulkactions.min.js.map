{"version":3,"file":"bulkactions.min.js","sources":["../src/bulkactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript module for bulk actions.\n *\n * @module      gradereport_singleview/bulkactions\n * @copyright   2022 Ilya Tregubov <ilya@moodle.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Pending from 'core/pending';\nimport CustomEvents from \"core/custom_interaction_events\";\nimport ModalFactory from 'core/modal_factory';\nimport Templates from 'core/templates';\nimport ModalEvents from 'core/modal_events';\n\n/**\n * Initialize module.\n */\nexport const init = () => {\n    const pendingPromise = new Pending();\n    registerListenerEvents();\n    pendingPromise.resolve();\n};\n\n/**\n * Register bulk actions related event listeners.\n *\n * @method registerListenerEvents\n */\nconst registerListenerEvents = () => {\n    const events = [\n        'click',\n        CustomEvents.events.activate,\n        CustomEvents.events.keyboardActivate\n    ];\n    CustomEvents.define(document, events);\n\n    // Register events.\n    events.forEach((event) => {\n        document.addEventListener(event, async(e) => {\n            const trigger = e.target.closest('[data-role]');\n            if (trigger) {\n                if ((trigger.dataset.role === 'overrideallgrades') || (trigger.dataset.role === 'overridenonegrades')) {\n                    const overrideAll = document.querySelectorAll('input[type=checkbox][name^=override]');\n\n                    if (trigger.dataset.role === 'overridenonegrades') {\n                        const confirm = new M.core.confirm({\n                            title: M.util.get_string('removeoverride', 'gradereport_singleview'),\n                            question: M.util.get_string('overridenoneconfirm', 'gradereport_singleview'),\n                            noLabel: M.util.get_string('cancel', 'moodle'),\n                            yesLabel: M.util.get_string('removeoverridesave', 'gradereport_singleview')\n                        });\n\n                        confirm.on('complete-yes', function () {\n                            confirm.hide();\n                            confirm.destroy();\n\n                            overrideAll.forEach(function (el) {\n                                if (el.checked) {\n                                    el.click();\n                                }\n                            });\n                        }, self);\n                        confirm.show();\n                    } else {\n                        overrideAll.forEach(function (el) {\n                            if (!el.checked) {\n                                el.click();\n                            }\n                        });\n                    }\n                } else if ((trigger.dataset.role === 'excludeallgrades') || (trigger.dataset.role === 'excludenonegrades')) {\n                    const excludeAll = document.querySelectorAll('input[type=checkbox][name^=exclude]');\n                    const checked = (trigger.dataset.role === 'excludeallgrades');\n                    excludeAll.forEach(function (el) {\n                        el.checked = checked;\n                    });\n                } else if (trigger.dataset.role === 'bulklegend') {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        body: Templates.render('gradereport_singleview/bulkinsert', {\n                            id: 'bulkinsertmodal',\n                            name: 'bulkinsertmodal'\n                        }),\n                        title: 'Bulk insert',\n                    })\n                        .then(function (modal) {\n                            modal.setSaveButtonText('Save');\n                            modal.getFooter().find('[data-action=\"save\"]').attr('disabled', true);\n\n                            modal.getRoot().on(ModalEvents.hidden, function () {\n                                modal.getRoot().remove();\n                            });\n\n                            modal.getRoot().on('change', 'input[type=\"checkbox\"]',\n                                (e) => {\n                                    e.preventDefault();\n                                    if (e.target.checked) {\n                                        modal.getRoot().find('.formdata').removeClass('dimmed_text');\n                                        modal.getRoot().find('input[type=\"radio\"]').removeAttr('disabled');\n                                        modal.getRoot().find('input[type=\"text\"]').removeAttr('disabled');\n\n                                        const formRadioData = modal.getRoot().find('input[type=\"radio\"]:checked').val();\n                                        if (formRadioData) {\n                                            modal.getFooter().find('[data-action=\"save\"]').removeAttr('disabled');\n                                        }\n                                    } else {\n                                        modal.getRoot().find('.formdata').addClass('dimmed_text');\n                                        modal.getRoot().find('input[type=\"radio\"]').attr('disabled', true);\n                                        modal.getRoot().find('input[type=\"text\"]').attr('disabled', true);\n                                        modal.getFooter().find('[data-action=\"save\"]').attr('disabled', true);\n                                    }\n                                });\n\n                            modal.getRoot().on('change', 'input[type=\"radio\"]',\n                                (e) => {\n                                    e.preventDefault();\n                                    modal.getFooter().find('[data-action=\"save\"]').removeAttr('disabled');\n                                });\n\n                            modal.getRoot().on(ModalEvents.save, function () {\n                                document.querySelector('input[type=\"checkbox\"][name^=bulk]').checked = true;\n\n                                const formRadioData = modal.getRoot().find('input[type=\"radio\"]:checked').val();\n                                const $select = document.querySelector('select[name^=bulk]');\n                                $select.value = formRadioData;\n\n                                const formData = modal.getRoot().find('.form-control').val();\n                                document.querySelector('input[type=\"text\"][name^=bulk]').value = formData;\n                                document.querySelector('input[type=\"submit\"]').click();\n                            });\n\n                            modal.show();\n\n                            return modal;\n                        });\n                }\n            }\n        });\n    });\n};\n"],"names":["pendingPromise","Pending","registerListenerEvents","resolve","events","CustomEvents","activate","keyboardActivate","define","document","forEach","event","addEventListener","async","trigger","e","target","closest","dataset","role","overrideAll","querySelectorAll","confirm","M","core","title","util","get_string","question","noLabel","yesLabel","on","hide","destroy","el","checked","click","self","show","excludeAll","create","type","ModalFactory","types","SAVE_CANCEL","body","Templates","render","id","name","then","modal","setSaveButtonText","getFooter","find","attr","getRoot","ModalEvents","hidden","remove","preventDefault","removeClass","removeAttr","val","addClass","save","querySelector","formRadioData","value","formData"],"mappings":";;;;;;;gXAgCoB,WACVA,eAAiB,IAAIC,iBAC3BC,yBACAF,eAAeG,iBAQbD,uBAAyB,WACrBE,OAAS,CACX,QACAC,mCAAaD,OAAOE,SACpBD,mCAAaD,OAAOG,qDAEXC,OAAOC,SAAUL,QAG9BA,OAAOM,SAASC,QACZF,SAASG,iBAAiBD,OAAOE,MAAAA,UACvBC,QAAUC,EAAEC,OAAOC,QAAQ,kBAC7BH,WAC8B,sBAAzBA,QAAQI,QAAQC,MAA2D,uBAAzBL,QAAQI,QAAQC,KAAgC,OAC7FC,YAAcX,SAASY,iBAAiB,2CAEjB,uBAAzBP,QAAQI,QAAQC,KAA+B,OACzCG,QAAU,IAAIC,EAAEC,KAAKF,QAAQ,CAC/BG,MAAOF,EAAEG,KAAKC,WAAW,iBAAkB,0BAC3CC,SAAUL,EAAEG,KAAKC,WAAW,sBAAuB,0BACnDE,QAASN,EAAEG,KAAKC,WAAW,SAAU,UACrCG,SAAUP,EAAEG,KAAKC,WAAW,qBAAsB,4BAGtDL,QAAQS,GAAG,gBAAgB,WACvBT,QAAQU,OACRV,QAAQW,UAERb,YAAYV,SAAQ,SAAUwB,IACtBA,GAAGC,SACHD,GAAGE,aAGZC,MACHf,QAAQgB,YAERlB,YAAYV,SAAQ,SAAUwB,IACrBA,GAAGC,SACJD,GAAGE,gBAIZ,GAA8B,qBAAzBtB,QAAQI,QAAQC,MAA0D,sBAAzBL,QAAQI,QAAQC,KAA+B,OAClGoB,WAAa9B,SAASY,iBAAiB,uCACvCc,QAAoC,qBAAzBrB,QAAQI,QAAQC,KACjCoB,WAAW7B,SAAQ,SAAUwB,IACzBA,GAAGC,QAAUA,eAEe,eAAzBrB,QAAQI,QAAQC,6BACVqB,OAAO,CAChBC,KAAMC,uBAAaC,MAAMC,YACzBC,KAAMC,mBAAUC,OAAO,oCAAqC,CACxDC,GAAI,kBACJC,KAAM,oBAEVxB,MAAO,gBAENyB,MAAK,SAAUC,cACZA,MAAMC,kBAAkB,QACxBD,MAAME,YAAYC,KAAK,wBAAwBC,KAAK,YAAY,GAEhEJ,MAAMK,UAAUzB,GAAG0B,sBAAYC,QAAQ,WACnCP,MAAMK,UAAUG,YAGpBR,MAAMK,UAAUzB,GAAG,SAAU,0BACxBhB,OACGA,EAAE6C,iBACE7C,EAAEC,OAAOmB,QAAS,CAClBgB,MAAMK,UAAUF,KAAK,aAAaO,YAAY,eAC9CV,MAAMK,UAAUF,KAAK,uBAAuBQ,WAAW,YACvDX,MAAMK,UAAUF,KAAK,sBAAsBQ,WAAW,YAEhCX,MAAMK,UAAUF,KAAK,+BAA+BS,OAEtEZ,MAAME,YAAYC,KAAK,wBAAwBQ,WAAW,iBAG9DX,MAAMK,UAAUF,KAAK,aAAaU,SAAS,eAC3Cb,MAAMK,UAAUF,KAAK,uBAAuBC,KAAK,YAAY,GAC7DJ,MAAMK,UAAUF,KAAK,sBAAsBC,KAAK,YAAY,GAC5DJ,MAAME,YAAYC,KAAK,wBAAwBC,KAAK,YAAY,MAI5EJ,MAAMK,UAAUzB,GAAG,SAAU,uBACxBhB,IACGA,EAAE6C,iBACFT,MAAME,YAAYC,KAAK,wBAAwBQ,WAAW,eAGlEX,MAAMK,UAAUzB,GAAG0B,sBAAYQ,MAAM,WACjCxD,SAASyD,cAAc,sCAAsC/B,SAAU,QAEjEgC,cAAgBhB,MAAMK,UAAUF,KAAK,+BAA+BS,MAC1DtD,SAASyD,cAAc,sBAC/BE,MAAQD,oBAEVE,SAAWlB,MAAMK,UAAUF,KAAK,iBAAiBS,MACvDtD,SAASyD,cAAc,kCAAkCE,MAAQC,SACjE5D,SAASyD,cAAc,wBAAwB9B,WAGnDe,MAAMb,OAECa"}